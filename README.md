# TrackBoundary_S AviUtl スクリプト

塗りつぶし2種 / 連結成分切り抜き / 穴埋めなどができる AviUtl アニメーション効果スクリプト 8 個セット．

[ダウンロードはこちら．](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/releases) [紹介動画．](https://www.nicovideo.jp/watch/sm43854186)

- [色領域塗りつぶし](#色領域塗りつぶし)

  ![色領域塗りつぶし](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/258f10f2-518d-4cd7-98a8-c9f5ff13028e)

- [透明領域塗りつぶし](#透明領域塗りつぶし)

  ![透明領域塗りつぶし](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/87443efe-e1f7-41f4-ab4d-44ae1e4b3cb3)

- [連結成分切り抜き](#連結成分切り抜き)

  ![連結成分切り抜き](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/f691f693-4370-487c-b5e7-5071949f7821)

- [連結成分切り抜き(複数)](#連結成分切り抜き複数)

  [連結成分切り抜き](#連結成分切り抜き)のアンカーが複数になった改変版です．

- [穴埋め](#穴埋め)

  ![穴埋め](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/b010a95f-900a-4d26-8979-4674b9dc8718)

  ![穴埋め応用例](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/ea8521f0-1060-438e-b883-d36e9466721e)

- [領域クロマキー](#領域クロマキー)

  ![領域クロマキー](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/64f4083d-0d08-4389-af29-420444d9fe70)

- [領域カラーキー](#領域カラーキー)

  [領域クロマキー](#領域クロマキー)の「カラーキー」版です．

- [領域ルミナンスキー](#領域ルミナンスキー)

  [領域クロマキー](#領域クロマキー)の「ルミナンスキー」版です．

## 動作要件

- AviUtl 1.10 (1.00 でも動作するはずだが 1.10 推奨)

  http://spring-fragrance.mints.ne.jp/aviutl

- 拡張編集 0.92

  - 0.93rc1 でも動作するはずだが未確認 / 非推奨．

- [LuaJIT](https://luajit.org/)

  バイナリのダウンロードは[こちら](https://github.com/Per-Terra/LuaJIT-Auto-Builds/releases)からできます．

  - 拡張編集 0.93rc1 同梱の `lua51jit.dll` は***バージョンが古く既知のバグもあるため非推奨***です．
  - AviUtl のフォルダにある `lua51.dll` と置き換えてください．

## 導入方法

以下のフォルダのいずれかに `@TrackBoundary_S.anm` と `TrackBoundary_S.lua` をコピーしてください．

1. `exedit.auf` のあるフォルダにある `script` フォルダ
1. (1) のフォルダにある任意の名前のフォルダ


## 使い方

次の 8 つのアニメーション効果が使えます:

1.  [連結成分切り抜き](#連結成分切り抜き)
1.  [連結成分切り抜き(複数)](#連結成分切り抜き複数)
1.  [色領域塗りつぶし](#色領域塗りつぶし)
1.  [透明領域塗りつぶし](#透明領域塗りつぶし)
1.  [穴埋め](#穴埋め)
1.  [領域クロマキー](#領域クロマキー)
1.  [領域カラーキー](#領域カラーキー)
1.  [領域ルミナンスキー](#領域ルミナンスキー)

### 連結成分切り抜き

アンカーで指定した点を含む，透明度を境とした連結成分以外を隠します．「反転」のチェックを入れると逆に指定した連結成分のみを隠します．

![連結成分切り抜き](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/f691f693-4370-487c-b5e7-5071949f7821)

- `X`, `Y`（トラックバー）

  アンカーの X, Y 座標です．ここで指定した点を含む連結成分が表示 / 非表示の対象になります．初期値は原点 $(0,0)$.

- `不透明度`（トラックバー）

  隠す連結成分の不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `0`（完全透明）．

- `αしきい値`（トラックバー）

  各ピクセルが「つながっている」と判定する $\alpha$ 値のしきい値を % 単位で指定します．初期値は `0`.

- `反転`（チェック）

  1.  `OFF` のとき，アンカーで指定した連結成分のみが表示されます．
  1.  `ON` のとき，アンカーで指定した連結成分以外が表示されます．

  初期値は `OFF`.

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している 2 ピクセルを「つながっている」と扱うかどうかを指定します．初期値は `OFF`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [0] = check0, -- boolean 型 で "反転" の項目を上書き，または nil. 0 を false, 0 以外を true 扱いとして number 型も可能．
    [1] = track0, -- number 型で "X" の項目を上書き，または nil.
    [2] = track1, -- number 型で "Y" の項目を上書き，または nil.
    [3] = track2, -- number 型で "不透明度" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
  }
  ```


### 連結成分切り抜き(複数)

[連結成分切り抜き](#連結成分切り抜き)でアンカーを複数設置できるように改変したものです．ただしアンカー位置がトラックバーで変化させられないため，中間点を利用したアニメーションなどが難しくなります．

- `指定数`（トラックバー）

  設置するアンカーの個数です．最大16個まで置くことができます．初期値は `1`.

- `内側α値`（トラックバー）

  アンカーの設置された連結成分の不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `100`（完全不透明）．

- `外側α値`（トラックバー）

  アンカーの設置されていない連結成分の不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `0`（完全透明）．

- `αしきい値`（トラックバー）

  各ピクセルが「つながっている」と判定する $\alpha$ 値のしきい値を % 単位で指定します．初期値は `0`.

- `反転`（チェック）

  `ON` にすると，`内側α値` と `外側α値` の役割を入れ替えます．初期値は `OFF`.

- `位置`（ダイアログの入力欄）

  アンカー位置を示す `table` 型を記述します．アンカーはマウス操作で動かすことでも指定できます．`指定数` $\times 2$ 個の `number` が並んだ配列で，前から順番に 2 つずつで各点の X, Y 座標を指定します．初期値は `{0,0}`（オブジェクト中央に1点）．

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している 2 ピクセルを「つながっている」と扱うかどうかを指定します．初期値は `OFF`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [0] = check0, -- boolean 型 で "反転" の項目を上書き，または nil. 0 を false, 0 以外を true 扱いとして number 型も可能．
    [1] = track0, -- number 型で "指定数" の項目を上書き，または nil. GUI で操作できるアンカー数には影響しないため，追加した点の座標は pos フィールドで指定してください．
    [2] = track1, -- number 型で "内側α値" の項目を上書き，または nil.
    [3] = track2, -- number 型で "外側α値" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
    pos = anchor, -- table 型で "位置" の項目を上書き，または nil. {123,nil, nil,42} など X, Y 片方のみの指定も可能．
  }
  ```


### 色領域塗りつぶし

アンカーで指定した点を含み，そこからつながっている近い色の領域を指定色で塗りつぶします．塗りつぶさずに透明 / 半透明に切り抜いたり，逆に指定した色領域以外を透明にしたりもできます．

![色領域塗りつぶし](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/258f10f2-518d-4cd7-98a8-c9f5ff13028e)

- `不透明度`（トラックバー）

  指定した色領域の不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `100`（完全不透明）．

- `着色強さ`（トラックバー）

  指定した色領域を指定した別の色で置き換えるときの，指定色の割合を % 単位で指定します．初期値は `100`．

- `色範囲`（トラックバー）

  指定した点の色からどのくらい近い色を塗りつぶすかの許容範囲を指定します．初期値は `8`.

  - 例えば `8` を指定して，`RGB(100,100,100)` (#646464) の灰色の点にアンカーを置いた場合，`RGB(92,92,92)` から `RGB(108,108,108)` までの範囲の色が塗りつぶしの対象になります．

- `αしきい値`（トラックバー）

  各ピクセルが「つながっている」と判定する $\alpha$ 値のしきい値を % 単位で指定します．初期値は `0`.

- `着色で輝度を保持`（チェック）

  指定した色領域を指定した別の色で置き換えるとき，輝度成分だけは色領域にあった元の色の値のままにします．初期値は `OFF`.

- `位置`（ダイアログの入力欄）

  アンカー位置を示す `table` 型を記述します．アンカーはマウス操作で動かすことでも指定できます．初期値は `{0,0}`（オブジェクト中央）．

- `R範囲補正`, `G範囲補正`, `B範囲補正`（ダイアログの入力欄）

  `色範囲` を R, G, B の成分ごとに個別に調節できます．`色範囲` で指定した値に乗じて成分ごとの範囲が決定します．

  - 例えば `色範囲` が `8` で，`R範囲補正` が `2.0` の場合，赤成分に限って許容範囲が `16` 相当になります．

- `着色`（ダイアログの色選択）

  指定した色領域を，指定した別の色で置き換えられます．初期値は `0xffffff` (`#ffffff`) の白色．

- `前景α値(%)`（ダイアログの入力欄）

  指定した色領域の外側の不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `100`（完全不透明）．

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している 2 ピクセルを「つながっている」と扱うかどうかを指定します．初期値は `OFF`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [0] = check0, -- boolean 型 で "着色で輝度を保持" の項目を上書き，または nil. 0 を false, 0 以外を true 扱いとして number 型も可能．
    [1] = track0, -- number 型で "不透明度" の項目を上書き，または nil.
    [2] = track1, -- number 型で "着色強さ" の項目を上書き，または nil.
    [3] = track2, -- number 型で "色範囲" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
    pos = anchor, -- table 型で "位置" の項目を上書き，または nil. {123,nil}, {nil,42} など X, Y 片方のみの指定も可能．
  }
  ```

### 透明領域塗りつぶし

アンカーで指定した点を含む透明領域を指定色で塗りつぶします．

![透明領域塗りつぶし](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/87443efe-e1f7-41f4-ab4d-44ae1e4b3cb3)

- `X`, `Y`（トラックバー）

  アンカーの X, Y 座標です．ここで指定した点を含む透明領域が塗りつぶしの対象になります．初期値は原点 $(0,0)$.

- `不透明度`（トラックバー）

  塗りつぶしの不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `100`（完全不透明）．

- `αしきい値`（トラックバー）

  透明なピクセルと判定する $\alpha$ 値のしきい値を % 単位で指定します．初期値は `100`.

- `色`（ダイアログの色選択）

  透明領域を塗りつぶす色を選択します．初期値は `0xffffff` (`#ffffff`) の白色．

- `前景α値(%)`（ダイアログの入力欄）

  塗りつぶし範囲外の不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `100`（完全不透明）．

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している不透明な 2 ピクセルを「つながっている」と扱うかどうかを指定します．初期値は `ON`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [1] = track0, -- number 型で "X" の項目を上書き，または nil.
    [2] = track1, -- number 型で "Y" の項目を上書き，または nil.
    [3] = track2, -- number 型で "不透明度" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
  }
  ```

### 穴埋め

画像外枠に接していない透明領域を不透明にしたり指定色で塗りつぶしたりできます．逆に画像外枠に接している透明領域のみを不透明にすることもできます．

![穴埋め](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/b010a95f-900a-4d26-8979-4674b9dc8718)

カラーキーなどのフィルタ効果を適用して外側の縁を消去した際，内側に巻き添えで空いてしまった穴を塞ぐ目的で作成しました．その目的の影響もあって，完全不透明で本来が無意味のはずの色成分が見えるようになるため注意してください．

![穴埋め応用例](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/ea8521f0-1060-438e-b883-d36e9466721e)


- `不透明度`（トラックバー）

  塗りつぶす透明領域に設定する不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `100`（完全不透明）．

- `着色強さ`（トラックバー）

  塗りつぶす透明領域に指定した別の色で置き換えるときの，指定色の割合を % 単位で指定します．初期値は `100`．

  - `100` 未満にすると，本来完全透明で見えないはずのピクセルの色成分が見えるようになるため，不定動作に注意してください．

- `前景α値`（トラックバー）

  塗りつぶし範囲外の不透明度 ($\alpha$ 値) を % 単位で指定します．初期値は `100`（完全不透明）．

- `αしきい値`（トラックバー）

  不透明なピクセルと判定する $\alpha$ 値のしきい値を % 単位で指定します．初期値は `100`.

- `外枠埋め`（チェック）

  塗りつぶす透明領域を，画像外枠に接している部分に切り替えます．初期値は `OFF`.

- `色`（ダイアログの色選択）

  透明領域を塗りつぶす色を選択します．初期値は `0xffffff` (`#ffffff`) の白色．

  - `輝度の保持`（ダイアログのチェック）

    透明領域を塗りつぶすとき，輝度成分だけは元の値のままにします．初期値は `OFF`.

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している不透明な 2 ピクセルを「つながっている」と扱うかどうかを指定します．初期値は `OFF`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [0] = check0, -- boolean 型 で "外枠埋め" の項目を上書き，または nil. 0 を false, 0 以外を true 扱いとして number 型も可能．
    [1] = track0, -- number 型で "不透明度" の項目を上書き，または nil.
    [2] = track1, -- number 型で "着色強さ" の項目を上書き，または nil.
    [3] = track2, -- number 型で "前景α値" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
  }
  ```

### 領域クロマキー

フィルタ効果の「クロマキー」を，アンカーを設置した部分にだけ適用します．逆にアンカーを設置した部分のみクロマキーを適用しないようにすることもできます．

![領域クロマキー](https://github.com/sigma-axis/aviutl_script_TrackBoundary_S/assets/132639613/64f4083d-0d08-4389-af29-420444d9fe70)

背景色が適切でない画像・動画の透過部分設定に利用できます．

- `指定数`（トラックバー）

  設置するアンカーの個数です．最大16個まで置くことができます．初期値は `1`.

- `色相範囲`，`彩度範囲`（トラックバー）

  フィルタ効果の「クロマキー」で指定する「色相範囲」と「彩度範囲」の値です．初期値はそれぞれ `24`, `96`.

- `αしきい値`（トラックバー）

  普通に「クロマキー」を適用して，ここで指定した分だけ不透明度が下がったピクセルがアンカーの領域指定の対象となります．初期値は `0`.

- `反転`（チェック）

  アンカーで指定した範囲のみ「クロマキー」を適用しないようにする状態にします．初期値は `OFF`.

- `位置`（ダイアログの入力欄）

  アンカー位置を示す `table` 型を記述します．アンカーはマウス操作で動かすことでも指定できます．`指定数` $\times 2$ 個の `number` が並んだ配列で，前から順番に 2 つずつで各点の X, Y 座標を指定します．初期値は `{0,0}`（オブジェクト中央に1点）．

- `透過色`（ダイアログの色選択）

  「クロマキー」で指定するキー色です．初期値は `0xffffff` (`#ffffff`) の白色．

- `境界補正`（ダイアログの入力欄）

  フィルタ効果の「クロマキー」で指定する「境界補正」の値です．初期値は `1`.

  - `四辺に配慮`（ダイアログのチェック）

    `境界補正` が `1` 以上のときにクロマキーを適用すると画像の上下左右の 4 辺が透けるため，ここから領域がつながっていると判定されてしまうのを抑制します．`境界補正` が `1` 以上のときのみ有効です．初期値は `ON`.

- `色彩補正`，`透過補正`（ダイアログのチェック）

  「クロマキー」で指定する「色彩補正」「透過補正」の値です．`透過補正` は `色彩補正` が `ON` のときのみ有効です．初期値は両方 `OFF`.

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している 2 ピクセルを「つながっている」としてアンカー位置から到達できるとみなすどうかを指定します．初期値は `OFF`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [0] = check0, -- boolean 型 で "反転" の項目を上書き，または nil. 0 を false, 0 以外を true 扱いとして number 型も可能．
    [1] = track0, -- number 型で "指定数" の項目を上書き，または nil. GUI で操作できるアンカー数には影響しないため，追加した点の座標は pos フィールドで指定してください．
    [2] = track1, -- number 型で "色相範囲" の項目を上書き，または nil.
    [3] = track2, -- number 型で "彩度範囲" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
    pos = anchor, -- table 型で "位置" の項目を上書き，または nil. {123,nil, nil,42} など X, Y 片方のみの指定も可能．
  }
  ```

### 領域カラーキー

[領域クロマキー](#領域クロマキー)の「カラーキー」版です．アンカーで指定した部分のみ「カラーキー」を適用したり，適用から除外したりできます．

- `指定数`（トラックバー）

  設置するアンカーの個数です．最大16個まで置くことができます．初期値は `1`.

- `輝度範囲`，`色差範囲`（トラックバー）

  フィルタ効果の「カラーキー」で指定する「色相範囲」と「彩度範囲」の値です．初期値は両方 `0`.

- `αしきい値`（トラックバー）

  普通に「カラーキー」を適用して，ここで指定した分だけ不透明度が下がったピクセルがアンカーの領域指定の対象となります．初期値は `0`.

- `反転`（チェック）

  アンカーで指定した範囲のみ「カラーキー」を適用しないようにする状態にします．初期値は `OFF`.

- `位置`（ダイアログの入力欄）

  アンカー位置を示す `table` 型を記述します．アンカーはマウス操作で動かすことでも指定できます．`指定数` $\times 2$ 個の `number` が並んだ配列で，前から順番に 2 つずつで各点の X, Y 座標を指定します．初期値は `{0,0}`（オブジェクト中央に1点）．

- `透過色`（ダイアログの色選択）

  「カラーキー」で指定するキー色です．初期値は `0xffffff` (`#ffffff`) の白色．

- `境界補正`（ダイアログの入力欄）

  フィルタ効果の「カラーキー」で指定する「境界補正」の値です．初期値は `0`.

  - `四辺に配慮`（ダイアログのチェック）

    `境界補正` が `1` 以上のときにカラーキーを適用すると画像の上下左右の 4 辺が透けるため，ここから領域がつながっていると判定されてしまうのを抑制します．`境界補正` が `1` 以上のときのみ有効です．初期値は `ON`.

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している 2 ピクセルを「つながっている」としてアンカー位置から到達できるとみなすどうかを指定します．初期値は `OFF`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [0] = check0, -- boolean 型 で "反転" の項目を上書き，または nil. 0 を false, 0 以外を true 扱いとして number 型も可能．
    [1] = track0, -- number 型で "指定数" の項目を上書き，または nil. GUI で操作できるアンカー数には影響しないため，追加した点の座標は pos フィールドで指定してください．
    [2] = track1, -- number 型で "輝度範囲" の項目を上書き，または nil.
    [3] = track2, -- number 型で "色差範囲" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
    pos = anchor, -- table 型で "位置" の項目を上書き，または nil. {123,nil, nil,42} など X, Y 片方のみの指定も可能．
  }
  ```


### 領域ルミナンスキー

[領域クロマキー](#領域クロマキー)の「ルミナンスキー」版です．アンカーで指定した部分のみ「ルミナンスキー」を適用したり，適用から除外したりできます．

- `指定数`（トラックバー）

  設置するアンカーの個数です．最大16個まで置くことができます．初期値は `1`.

- `基準輝度`，`ぼかし`（トラックバー）

  フィルタ効果の「ルミナンスキー」で指定する「基準輝度」と「ぼかし」の値です．初期値はそれぞれ `2048`, `512`.

- `αしきい値`（トラックバー）

  普通に「ルミナンスキー」を適用して，ここで指定した分だけ不透明度が下がったピクセルがアンカーの領域指定の対象となります．初期値は `0`.

- `反転`（チェック）

  アンカーで指定した範囲のみ「ルミナンスキー」を適用しないようにする状態にします．初期値は `OFF`.

- `位置`（ダイアログの入力欄）

  アンカー位置を示す `table` 型を記述します．アンカーはマウス操作で動かすことでも指定できます．`指定数` $\times 2$ 個の `number` が並んだ配列で，前から順番に 2 つずつで各点の X, Y 座標を指定します．初期値は `{0,0}`（オブジェクト中央に1点）．

- `タイプ`（ダイアログの色選択）

  「ルミナンスキー」で指定する透過方法 4 種類を `0` から `3` の数値で指定します．対応は以下の表の通りです:

  | `タイプ` | 内容 |
  |:---:|:---|
  | `0` | 暗い部分を透過 |
  | `1` | 明るい部分を透過 |
  | `2` | 明暗部分を透過 |
  | `3` | 明暗部分を透過(ぼかし無し) |

  初期値は `0` です．

- `角で隣接扱い`（ダイアログのチェック）

  市松模様の格子部分のように，角のみで隣接している 2 ピクセルを「つながっている」としてアンカー位置から到達できるとみなすどうかを指定します．初期値は `OFF`.

- `PI`（ダイアログの入力欄）

  パラメタインジェクション用の入力枠です．次の形の `table` 型，または `nil` を受け付けます．初期値は空欄 (`nil` 扱い).

  ```lua
  {
    [0] = check0, -- boolean 型 で "反転" の項目を上書き，または nil. 0 を false, 0 以外を true 扱いとして number 型も可能．
    [1] = track0, -- number 型で "指定数" の項目を上書き，または nil. GUI で操作できるアンカー数には影響しないため，追加した点の座標は pos フィールドで指定してください．
    [2] = track1, -- number 型で "基準輝度" の項目を上書き，または nil.
    [3] = track2, -- number 型で "ぼかし" の項目を上書き，または nil.
    [4] = track3, -- number 型で "αしきい値" の項目を上書き，または nil.
    pos = anchor, -- table 型で "位置" の項目を上書き，または nil. {123,nil, nil,42} など X, Y 片方のみの指定も可能．
  }
  ```


## TIPS

1.  アンカーを利用する場合，このスクリプト適用前のフィルタ効果で Z 座標移動や拡大率，回転効果が設定されていると，アンカー位置が正しく認識されないことがあります．Z 軸方向への移動や拡大率，回転効果を付与する場合は，このスクリプト以降にフィルタ効果をかけてください．

    - 標準描画や拡張描画による座標指定や拡大率，回転に関しては問題ありません．

1.  [色領域塗りつぶし](#色領域塗りつぶし)は，機能面では[連結成分切り抜き](#連結成分切り抜き)の上位互換です．

    色領域塗りつぶしの `色範囲` を最大にして `着色強さ` と `前景α値(%)` を `0` にすれば連結成分切り抜きと同じ効果が得られます．`不透明度` と `前景α値(%)` を入れ替えれば `反転` も可能です．

    ただし連結成分切り抜きはアンカー位置がトラックバーで動かせるため，中間点を用いたアニメーションを設定しやすいなどの点が異なります．また連結成分切り抜きのほうが処理速度が高速です．


1.  [色領域塗りつぶし](#色領域塗りつぶし)と類似のスクリプトとして，のなめ様の[塗り潰しで透過スクリプト](https://www.nicovideo.jp/watch/sm42068071)がありますが次のような違いがあります．

    - こちらのスクリプトのほうが高速です．試した限りの全ての場合でこちらのほうが高速に動作しました．

      おおよそ 4 倍程度速いようです．

    - 塗り潰しで透過スクリプトでしかできない機能もあります:

      1.  アンカーを複数個設置できます．
      1.  「範囲外からも塗る」オプションがあります．

          画像の上下左右4辺から塗りつぶし領域がつながっているような形で塗りつぶせます．

    - こちらのスクリプトでしかできない機能もあります:

      1.  塗りつぶし領域や塗りつぶし範囲外の透明度を個別に指定できます．
      1.  塗りつぶしの色の強さや，輝度を保持するかどうかを選べます．
      1.  「角で隣接扱い」のオプションがあります．
      1.  パラメタインジェクションができます．

1.  [透明領域塗りつぶし](#透明領域塗りつぶし)と類似のスクリプトとして，ティム様の[透明塗り](http://www.nicovideo.jp/watch/sm20426178)がありますが次のような違いがあります．

    - 実行速度に違いがあります．

      - 透明塗りの「改良計算」が `ON`（初期値）の場合での比較だと，こちらのほうが高速でした．

        塗り面積が大きいほど差が顕著で，約 3 倍の差が付く場面もありました．

      - 透明塗りの「改良計算」が `OFF` の場合だと，透明塗りのほうが高速な場面もありました．

        傾向は不明ですが，最大で約 1.5 倍の差が付く場面もありました．ほとんど差がない場面もあります．

        - ただしこの場合，塗りつぶし部分の透明度を指定できません．

    - こちらのスクリプトでしかできない機能があります:

      1.  塗りつぶし範囲外の透明度を指定できます．
      1.  「角で隣接扱い」のオプションがあります．
      1.  パラメタインジェクションができます．

1.  [領域クロマキー](#領域クロマキー)，[領域カラーキー](#領域カラーキー)，[領域ルミナンスキー](#領域ルミナンスキー)は，それぞれ「クロマキー」「カラーキー」「ルミナンスキー」を普通に適用するよりも低速です．必要な場面にのみ使用するのが効率が良くなります．

1.  テキストエディタで `@TrackBoundary_S.anm` と `TrackBoundary_S.lua` を開くと冒頭付近にファイルバージョンが付記されています．

    ```lua
    --
    -- VERSION: v1.23
    --
    ```

    2 つのバージョンが異なる場合，更新漏れの可能性があるためご確認ください．


## 改版履歴

- **v1.22** (2024-06-02)

  - `領域クロマキー`，`領域カラーキー` で色指定がうまく解釈されなかったことがあったのを修正．


- **v1.22** (2024-06-02)

  - `領域クロマキー`，`領域カラーキー` で最大画像サイズに近い場合の対処のミス修正．

  - `領域カラーキー` の `境界補正` に数値以外を入力していた場合，初期値の `0` とは異なる `1` を代わりの値として採用していたのを修正．

- **v1.21** (2024-06-01)

  - `領域クロマキー`，`領域カラーキー` の `角で隣接扱い` の初期値を `OFF` に修正．

- **v1.20** (2024-06-01)

  - `領域クロマキー`，`領域カラーキー`，`領域ルミナンスキー` の 3 つを追加．

    アンカーで指定した部分だけクロマキーなどを適用できます．逆にアンカーで指定した部分を適用から除外することもできます．

- **v1.11** (2024-05-31)

  - `角で隣接扱い` の初期値を変更．なるべくよくある画像編集ソフトの挙動に近いと思われるものにした．

    - 既に既存のプロジェクトに利用していた場合，この変更による影響はありません．

- **v1.10** (2024-05-24)

  - `連結成分切り抜き(複数)` を追加．

  - コード整理．

- **v1.00** (2024-05-18)

  - 初版．


## ライセンス

このプログラムの利用・改変・再頒布等に関しては MIT ライセンスに従うものとします．

---

The MIT License (MIT)

Copyright (C) 2024 sigma-axis

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

https://mit-license.org/


#  連絡・バグ報告

- GitHub: https://github.com/sigma-axis
- Twitter: https://twitter.com/sigma_axis
- nicovideo: https://www.nicovideo.jp/user/51492481
- Misskey.io: https://misskey.io/@sigma_axis
- Bluesky: https://bsky.app/profile/sigma-axis.bsky.social
